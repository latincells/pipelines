process {
    container = 'adolforojas/latincells:SeuratEnv'
    withName: Cellranger {
        cpus = 12
        memory = '70 GB'
        container = 'adolforojas/latincells:Cellranger'
    }
    withName: CellTypist {
        container = 'adolforojas/latincells:Celltypist'
    }
    withLabel: Demultiplex {
    container = 'adolforojas/latincells:Demultiplex'
    memory = '50 GB'
    }
}

docker {
    fixOwnership = true
}

singularity {
    ociMode = true
}

timeline {
    enabled = true
    file = 'Timeline.html'
    overwrite = true
}

report {
    enabled = true
    file = 'Report.html'
    overwrite = true
}

dag {
    enabled = true
    file = 'DAG.html'
    overwrite = true
    verbose = true
}
apptainer {
    runOptions = '--compat --fakeroot'
    cacheDir = '/home/arojas/Apptainer_Images'
}
profiles {
    NLHPC {
        apptainer {
            enabled = true
        }
        mail {
            enabled = true
            from = 'adolfo.rojas@ug.uchile.cl'
            to = 'adolfo.rojas@ug.uchile.cl'
            smtp {
                host = 'smtp.gmail.com'
                port = 587
                user = System.getenv('SMTP_USER')
                password = System.getenv('SMTP_PASS')
                ssl.protocols = 'TLSv1.2'
                starttls.enable = true
            }
        }
        process {
            executor = "slurm"
            memory = "50 GB"
            cpus = 1
            withName: Cellranger {
                cpus = 28
                memory = '170 GB'
                maxForks = 3
                container = 'adolforojas/latincells:Cellranger'
            }
            withName: SoupX_scDblFinder {
                cpus = 2
                memory = '80 GB'
                maxForks = 40
            }
            withLabel: Demultiplex {
                cpus = 2
                maxForks = 40
                memory = '80 GB'
                container = 'adolforojas/latincells:Demultiplex'
            }
            withLabel: BigMem {
                cpus = 5
                maxForks = 1
                memory = '250 GB'
            }
            withName: MappingStats {
                cpus = 1
                memory = '2 GB'
            }
        }
    }
    BigMem {
        apptainer {
            enabled = true
        }
        mail {
            enabled = true
            from = 'adolfo.rojas@ug.uchile.cl'
            to = 'adolfo.rojas@ug.uchile.cl'
            smtp {
                host = 'smtp.gmail.com'
                port = 587
                user = System.getenv('SMTP_USER')
                password = System.getenv('SMTP_PASS')
                ssl.protocols = 'TLSv1.2'
                starttls.enable = true
            }
        }
        process {
            executor = "slurm"
            memory = "50 GB"
            cpus = 1
            withName: Cellranger {
                cpus = 28
                memory = '170 GB'
                maxForks = 3
                container = 'adolforojas/latincells:Cellranger'
            }
            withName: SoupX_scDblFinder {
                cpus = 2
                memory = '80 GB'
                maxForks = 40
            }
            withLabel: Demultiplex {
                cpus = 2
                maxForks = 40
                memory = '80 GB'
                container = 'adolforojas/latincells:Demultiplex'
            }
            withLabel: BigMem {
                cpus = 2
                maxForks = 1
                memory = '500 GB'
            }
            withName: MappingStats {
                cpus = 1
                memory = '2 GB'
            }
        }
    }
}