process {
    container = 'adolforojas/latincells:SeuratEnv'
    withName: Cellranger {
        cpus = 12
        memory = '70 GB'
        container = 'adolforojas/latincells:Cellranger'
    }
    withName: CellTypist {
        container = 'adolforojas/latincells:Celltypist'
    }
    withLabel: Demultiplex {
    container = 'adolforojas/latincells:Demultiplex'
    memory = '50 GB'
    }
}

docker {
    fixOwnership = true
}

singularity {
    ociMode = true
}

timeline {
    enabled = true
    file = 'Timeline.html'
    overwrite = true
}

report {
    enabled = true
    file = 'Report.html'
    overwrite = true
}

dag {
    enabled = true
    file = 'DAG.html'
    overwrite = true
    verbose = true
}
apptainer {
    runOptions = '--compat --fakeroot'
    cacheDir = '/home/arojas/Apptainer_Images'
}
profiles {
    NLHPC {
        apptainer {
            enabled = true
        }
        process {
            executor = "slurm"
            memory = "320 GB"
            withName: Cellranger {
                cpus = 28
                memory = '170 GB'
                maxForks = 3
                container = 'adolforojas/latincells:Cellranger'
            }
            withName: SoupX_scDblFinder {
                cpus = 20
                memory = '80 GB'
                maxForks = 3
            }
            withLabel: Demultiplex {
                cpus = 10
                maxForks = 8
                memory = '80 GB'
                container = 'adolforojas/latincells:Demultiplex'
            }
            withName: MappingStats {
                cpus = 2
                memory = '2 GB'
            }
        }
    }
    BigMem {
        apptainer {
            enabled = true
        }
        process {
            executor = "slurm"
            memory = "320 GB"
            withName: Cellranger {
                cpus = 28
                memory = '170 GB'
                maxForks = 3
                container = 'adolforojas/latincells:Cellranger'
            }
            withName: SoupX_scDblFinder {
                cpus = 2
                memory = '80 GB'
                maxForks = 26
            }
            withLabel: Demultiplex {
                cpus = 3
                maxForks = 26
                memory = '80 GB'
                container = 'adolforojas/latincells:Demultiplex'
            }
            withLabel: BigMem {
                cpus = 5
                maxForks = 1
                memory = '350 GB'
            }
            withName: MappingStats {
                cpus = 2
                memory = '2 GB'
            }
        }
    }
}